# Курс "Сети и протоколы"

**Computer Networks and Protocols**  
Университет ИТМО  
2025–2026 уч. год  

---

## Практическая работа №10

**Задание:**  
Разработать систему мониторинга использования DNS-резолверов конечными пользователями автономных систем российских интернет-провайдеров. Для этого необходимо реализовать определение принадлежности IP-адресов автономным системам через базы whois и RADB, выявить используемые автономные системы по логам HTTP-сервера с сохранением данных в СУБД и отображением статистики, определить автономные системы DNS-провайдеров через анализ логов авторитетного DNS-сервера, освоить выпуск и автоматическое обновление wildcard-сертификатов Let’s Encrypt, реализовать сопоставление HTTP- и DNS-запросов, загрузку измерительного JavaScript-скрипта со стороннего сайта без ошибок CORS, отображение прогресса асинхронной загрузки контента на веб-странице, асинхронное взаимодействие с серверной БД по REST API, построение графика выделения номеров AS российским LIR по статистике RIPE NCC, а также определение unicast-адресов резолверов Национальной системы доменных имен по логам.

---

## Краткое описание выполненной работы

Для реализации общей задачи были реализованы следующие подзадачи:

- Запущена VPS на OS Linux (Ubuntu Server) и куплен тестовый домен **ns-testing-rr.ru**.  
  В качестве NS-серверов выбраны `ns1.ns-testing-rr.ru` и `ns2.ns-testing-rr.ru`, настроен сервис BIND и базовый фаервол.  
- Реализован выпуск wildcard-сертификатов для `*.ns-testing-rr.ru` с помощью Let’s Encrypt (certbot) и плагина certbot-dns-rfc2136 (для DNS-валидации), включая автообновление.  
- Настроен и установлен NGINX для раздачи статического контента.  
- Реализован микросервер на базе Python FastAPI для построения веб-приложения.  
- Веб-приложение на HTML+JS с реализацией асинхронного взаимодействия с серверной БД по REST API, отработкой CORS-запросов и отображением статистики.  
- Определение принадлежности IP-адресов автономным системам через базы whois и RADB (с использованием API Team Cymru для ускорения и без этого).  
- Построение графика выделения номеров AS российским LIR по статистике RIPE NCC.  
- Определение unicast-адресов резолверов НСДИ по логам авторитетного DNS-сервера.  

---

## Основная механика сопоставления IP и DNS

Для сопоставления HTTP- и DNS-запросов используется механизм анализа логов:  

- В веб-приложении динамически генерируется уникальный поддомен (например, `abc123.ns-testing-rr.ru`).  
- Браузер пользователя делает DNS-запрос за этим поддоменом → в логах BIND фиксируется IP резолвера.  
- Далее браузер делает HTTP-запрос к серверу с этим же поддоменом → в логах HTTP фиксируется IP пользователя.  
- По уникальному токену поддомена можно связать пользователя и резолвер, через который он работает.  

---

## Структура проекта

```text
.
├── README.md                   # Основной отчет по проекту
├── letencrypt/                  # Настройка и использование Let's Encrypt
│   └── README.md                # Гайд по certbot + wildcard + автообновление
├── bind/                        # Настройка BIND и NS-серверов
│   └── README.md                # Краткое описание конфигурации
├── webapp/                      # Веб-приложение (фронтенд и бекенд)
│   ├── frontend/                # HTML + JS
│   ├── backend/                 # Python FastAPI
│   └── README.md                # Краткое описание запуска и функционала
├── analyze_asn/                 # Анализ DNS-серверов по логу авторитетного
│   ├── asn_lookup_teamcymru.py  # Пример через API Team Cymru
│   ├── asn_lookup_whois.py      # Пример через whois/RADB
│   └── README.md
└── unicast-nsdi/                # Анализ unicast-адресов НСДИ по логам
    ├── unicast_check.py         # Скрипт для логов BIND
    └── README.md
```

---

Конкретные описания выполненных блоков и их реализацию см. в соответствующих папках репозитория.  

---

### Авторы

- [@rzhevskyrobotics](https://github.com/rzhevskyrobotics)  
- [@EugeneDin](https://github.com/EugeneDin)  
